import random
import re

class LinguisticTutor:
    def __init__(self):
        self.role_name = "Репетитор русского языка"

    def get_instruction(self) -> str:
        """Динамическая установка, чтобы модель не привыкала к одной фразе."""
        guidelines = [
            "Твоя речь должна быть эталоном грамотности: безупречные падежи и логика.",
            "Соблюдай чистоту русского языка. Избегай косноязычия и иностранных вкраплений.",
            "Следи за согласованием слов. Грамматика должна быть идеальной.",
            "Твой стиль — академическая грамотность, соединенная с инженерной точностью."
        ]
        return f"Инструкция: {random.choice(guidelines)} ОТВЕЧАЙ ТОЛЬКО НА РУССКОМ."

    def clean(self, text: str) -> str:
        """
        Техническая очистка текста от иероглифов (CJK) и артефактов.
        Если текст превратился в мусор, возвращает уведомление об ошибке.
        """
        if not text:
            return ""

        # Регулярное выражение для поиска иероглифов (Китай, Япония, Корея)
        cjk_pattern = re.compile(r'[\u4e00-\u9fff\u3040-\u30ff\uac00-\ud7af]')
        
        # Если найдены иероглифы
        if cjk_pattern.search(text):
            # Удаляем их
            cleaned = cjk_pattern.sub('', text).strip()
            # Если после удаления почти ничего не осталось - значит ответ был полностью битый
            if len(cleaned) < 5:
                return "Ошибка: Сбой лингвистического процессора (обнаружен иностранный поток)."
            return cleaned

        return text.strip()

    def polish(self, text: str) -> str:
        """Место для будущих фильтров пост-обработки текста."""
        return self.clean(text)
